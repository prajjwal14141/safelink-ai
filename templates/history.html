<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeLink AI - Analysis History</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Base Styling & Fonts */
        :root { /* Using variables from index.html for consistency */
            --bg-primary: #0a0f1f; --bg-secondary: #10172d; --bg-card: rgba(18, 26, 49, 0.6);
            --border-color: rgba(56, 73, 117, 0.2); --text-primary: #e0e8f9; --text-secondary: #94a3b8;
            --accent-blue: #38bdf8; --accent-cyan: #2dd4bf; --accent-red: #fb7185; --accent-orange: #fb923c;
        }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--bg-primary); color: var(--text-primary);
            overscroll-behavior: none;
            background-image: linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                              linear-gradient(rgba(255, 255, 255, 0.03) .5px, transparent .5px),
                              linear-gradient(90deg, rgba(255, 255, 255, 0.03) .5px, transparent .5px);
            background-size: 1px 1px, 1px 1px, 30px 30px, 30px 30px;
        }
        h1, h2, h3, h4, h5, h6, button, th { font-family: 'Poppins', sans-serif; letter-spacing: -0.02em; }
        .glass-effect {
            background: var(--bg-card); backdrop-filter: blur(16px) saturate(120%);
            -webkit-backdrop-filter: blur(16px) saturate(120%); border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .fade-in { animation: fadeIn 0.7s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; } ::-webkit-scrollbar-thumb:hover { background: #4b5563; }

        /* Table Styles */
        thead th { background-color: rgba(55, 65, 81, 0.3); } /* Subtle header */
        tbody tr:hover { background-color: rgba(55, 65, 81, 0.2); } /* Hover effect */
        td, th { padding: 0.8rem 1.2rem; /* Adjusted padding */ }
        .table-url-cell { max-width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        @media (min-width: 640px) { .table-url-cell { max-width: 400px; } }
        @media (min-width: 1024px) { .table-url-cell { max-width: 500px; } }

        /* Button Style */
        .btn-danger {
            background-color: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--accent-red); transition: all 0.2s ease;
        }
        .btn-danger:hover { background-color: rgba(239, 68, 68, 0.25); border-color: rgba(239, 68, 68, 0.5); transform: scale(1.03); }
    </style>
</head>
<body class="text-gray-200 min-h-screen flex flex-col antialiased">

    <header class="sticky top-0 z-50 glass-effect border-b border-[var(--border-color)] shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
             <a href="/" class="text-xl font-bold text-white tracking-tight flex items-center gap-2">
                 <svg class="w-7 h-7 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                <span class="text-[var(--accent-cyan)]">Safe</span>Link <span class="font-light text-gray-400 text-lg">AI</span>
            </a>
            <div class="space-x-1 sm:space-x-2">
                <a href="/" class="px-3 py-2 text-xs sm:text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700/50 hover:text-white transition-colors duration-200">Detector</a>
                <a href="/how-it-works" class="px-3 py-2 text-xs sm:text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700/50 hover:text-white transition-colors duration-200">How It Works</a>
                <a href="/expander" class="px-3 py-2 text-xs sm:text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700/50 hover:text-white transition-colors duration-200">URL Expander</a>
                <a href="/history" class="px-3 py-2 text-xs sm:text-sm font-medium rounded-md text-white bg-blue-600/80 hover:bg-blue-600 transition-colors duration-200 shadow">History</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 py-16 sm:py-24 flex-grow">
        <div class="max-w-4xl mx-auto fade-in">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-white text-center mb-6 tracking-tight">Analysis History</h1>
            <p class="text-base sm:text-lg text-gray-400 text-center mb-10">
                Your last 20 URL analyses. Stored locally in your browser.
            </p>

            <!-- History Table Container -->
            <div class="glass-effect shadow-xl rounded-lg overflow-hidden border border-[var(--border-color)]">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-[var(--border-color)]">
                        <thead class="">
                            <tr>
                                <th scope="col" class="px-4 py-3 sm:px-6 sm:py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">URL Analyzed</th>
                                <th scope="col" class="px-4 py-3 sm:px-6 sm:py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Prediction</th>
                                <th scope="col" class="px-4 py-3 sm:px-6 sm:py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Date Checked</th>
                            </tr>
                        </thead>
                        <tbody id="history-table-body" class="divide-y divide-[var(--border-color)]">
                            <!-- Template for no history -->
                             <tr id="no-history-message" class="hidden">
                                 <td colspan="3" class="px-6 py-10 text-center text-gray-500 text-sm italic">
                                     Your analysis history is empty. Go analyze some URLs!
                                 </td>
                             </tr>
                             <!-- History rows added by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

             <div class="text-center mt-8">
                 <button id="clear-history" class="btn-danger hidden px-5 py-2 text-xs sm:text-sm font-semibold rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 focus:ring-offset-2 focus:ring-offset-gray-950">
                     Clear History
                 </button>
            </div>
        </div>
    </main>

    <footer class="bg-gray-950 text-gray-600 py-6 mt-auto border-t border-[var(--border-color)] text-center">
        <div class="container mx-auto px-6 text-xs">
            <p>&copy; 2025 SafeLink AI. For demonstration purposes only.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const historyTableBody = document.getElementById('history-table-body');
            const noHistoryMessage = document.getElementById('no-history-message');
            const clearHistoryButton = document.getElementById('clear-history');
            let history = [];

            function renderHistory() {
                 const rows = historyTableBody.querySelectorAll('tr:not(#no-history-message)');
                 rows.forEach(row => row.remove()); // Clear only generated rows

                 try { history = JSON.parse(localStorage.getItem('analysisHistory') || '[]'); }
                 catch (e) { console.error("Error parsing history:", e); history = []; }

                if (history.length === 0) {
                    noHistoryMessage.classList.remove('hidden');
                    clearHistoryButton.classList.add('hidden');
                } else {
                    noHistoryMessage.classList.add('hidden');
                    clearHistoryButton.classList.remove('hidden');
                    history.forEach((entry, index) => { // Added index for animation delay
                        const row = document.createElement('tr');
                        row.style.animationDelay = `${index * 50}ms`; // Stagger animation
                        row.classList.add('fade-in');

                        // URL Cell
                        const urlCell = document.createElement('td');
                        urlCell.className = 'px-4 py-3 sm:px-6 sm:py-4 text-sm text-gray-300 table-url-cell';
                        urlCell.textContent = entry.url;
                        urlCell.title = entry.url;
                        row.appendChild(urlCell);

                        // Prediction Cell
                        const predictionCell = document.createElement('td');
                        predictionCell.className = 'px-4 py-3 sm:px-6 sm:py-4 text-xs';
                        const predictionSpan = document.createElement('span');
                        predictionSpan.textContent = entry.is_malicious ? 'Malicious' : 'Safe';
                        predictionSpan.className = entry.is_malicious
                            ? 'px-2.5 py-0.5 inline-flex leading-4 font-semibold rounded-full bg-red-600/30 text-red-300 border border-red-500/30'
                            : 'px-2.5 py-0.5 inline-flex leading-4 font-semibold rounded-full bg-green-600/30 text-green-300 border border-green-500/30';
                        predictionCell.appendChild(predictionSpan);
                        row.appendChild(predictionCell);

                        // Timestamp Cell
                        const dateCell = document.createElement('td');
                        dateCell.className = 'px-4 py-3 sm:px-6 sm:py-4 whitespace-nowrap text-xs text-gray-500';
                        try {
                             const date = new Date(entry.timestamp);
                             dateCell.textContent = date.toLocaleDateString(undefined, { year: '2-digit', month: 'short', day: 'numeric' }) + ', ' + date.toLocaleTimeString(undefined, { hour: 'numeric', minute: '2-digit'});
                        } catch (e) { dateCell.textContent = '-'; }
                        row.appendChild(dateCell);

                        historyTableBody.appendChild(row);
                    });
                }
            }

             renderHistory();

             clearHistoryButton.addEventListener('click', () => {
                 // Using a more modern approach without confirm() if possible in future
                 if (window.confirm && confirm('Are you sure you want to clear your entire analysis history? This cannot be undone.')) {
                     localStorage.removeItem('analysisHistory');
                     history = [];
                     renderHistory();
                 } else if (!window.confirm) { // Fallback if confirm is blocked (e.g., iframe)
                      localStorage.removeItem('analysisHistory');
                      history = [];
                      renderHistory();
                      alert("History cleared (confirmation skipped).");
                 }
             });
        });
    </script>
</body>
</html>